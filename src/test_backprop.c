/* automatically generated by 'generate_test.py' */
void test_back_propagation()
{
    // create network
    int dims[] = {2, 3, 4, 5, 6, 7};
    Network network = network_create(6, dims);

    // fill network
    network.weights[1][0 * 2 + 0 * 1] = 0.6323062777519226;
    network.weights[1][0 * 2 + 1 * 1] = 0.3488934636116028;
    network.weights[1][1 * 2 + 0 * 1] = 0.40171730518341064;
    network.weights[1][1 * 2 + 1 * 1] = 0.022325754165649414;
    network.weights[1][2 * 2 + 0 * 1] = 0.16885894536972046;
    network.weights[1][2 * 2 + 1 * 1] = 0.2938884496688843;
    network.weights[2][0 * 3 + 0 * 1] = 0.518521785736084;
    network.weights[2][0 * 3 + 1 * 1] = 0.6976675987243652;
    network.weights[2][0 * 3 + 2 * 1] = 0.800011396408081;
    network.weights[2][1 * 3 + 0 * 1] = 0.16102945804595947;
    network.weights[2][1 * 3 + 1 * 1] = 0.28226858377456665;
    network.weights[2][1 * 3 + 2 * 1] = 0.6816085577011108;
    network.weights[2][2 * 3 + 0 * 1] = 0.9151939749717712;
    network.weights[2][2 * 3 + 1 * 1] = 0.39709991216659546;
    network.weights[2][2 * 3 + 2 * 1] = 0.8741558790206909;
    network.weights[2][3 * 3 + 0 * 1] = 0.41940832138061523;
    network.weights[2][3 * 3 + 1 * 1] = 0.5529070496559143;
    network.weights[2][3 * 3 + 2 * 1] = 0.9527381062507629;
    network.weights[3][0 * 4 + 0 * 1] = 0.036164820194244385;
    network.weights[3][0 * 4 + 1 * 1] = 0.1852310299873352;
    network.weights[3][0 * 4 + 2 * 1] = 0.37341737747192383;
    network.weights[3][0 * 4 + 3 * 1] = 0.3051000237464905;
    network.weights[3][1 * 4 + 0 * 1] = 0.9320003986358643;
    network.weights[3][1 * 4 + 1 * 1] = 0.17591017484664917;
    network.weights[3][1 * 4 + 2 * 1] = 0.2698335647583008;
    network.weights[3][1 * 4 + 3 * 1] = 0.15067976713180542;
    network.weights[3][2 * 4 + 0 * 1] = 0.03171950578689575;
    network.weights[3][2 * 4 + 1 * 1] = 0.20812976360321045;
    network.weights[3][2 * 4 + 2 * 1] = 0.9297990202903748;
    network.weights[3][2 * 4 + 3 * 1] = 0.7231091856956482;
    network.weights[3][3 * 4 + 0 * 1] = 0.7423362731933594;
    network.weights[3][3 * 4 + 1 * 1] = 0.5262957811355591;
    network.weights[3][3 * 4 + 2 * 1] = 0.24365824460983276;
    network.weights[3][3 * 4 + 3 * 1] = 0.584592342376709;
    network.weights[3][4 * 4 + 0 * 1] = 0.033152639865875244;
    network.weights[3][4 * 4 + 1 * 1] = 0.13871687650680542;
    network.weights[3][4 * 4 + 2 * 1] = 0.242235004901886;
    network.weights[3][4 * 4 + 3 * 1] = 0.815468966960907;
    network.weights[4][0 * 5 + 0 * 1] = 0.793160617351532;
    network.weights[4][0 * 5 + 1 * 1] = 0.2782524824142456;
    network.weights[4][0 * 5 + 2 * 1] = 0.48195880651474;
    network.weights[4][0 * 5 + 3 * 1] = 0.8197803497314453;
    network.weights[4][0 * 5 + 4 * 1] = 0.9970665574073792;
    network.weights[4][1 * 5 + 0 * 1] = 0.6984410881996155;
    network.weights[4][1 * 5 + 1 * 1] = 0.5675464272499084;
    network.weights[4][1 * 5 + 2 * 1] = 0.8352431654930115;
    network.weights[4][1 * 5 + 3 * 1] = 0.2055988311767578;
    network.weights[4][1 * 5 + 4 * 1] = 0.593172013759613;
    network.weights[4][2 * 5 + 0 * 1] = 0.11234724521636963;
    network.weights[4][2 * 5 + 1 * 1] = 0.1534569263458252;
    network.weights[4][2 * 5 + 2 * 1] = 0.24170821905136108;
    network.weights[4][2 * 5 + 3 * 1] = 0.7262365221977234;
    network.weights[4][2 * 5 + 4 * 1] = 0.7010802030563354;
    network.weights[4][3 * 5 + 0 * 1] = 0.2038237452507019;
    network.weights[4][3 * 5 + 1 * 1] = 0.6510535478591919;
    network.weights[4][3 * 5 + 2 * 1] = 0.7744860053062439;
    network.weights[4][3 * 5 + 3 * 1] = 0.4368913173675537;
    network.weights[4][3 * 5 + 4 * 1] = 0.5190907716751099;
    network.weights[4][4 * 5 + 0 * 1] = 0.6158523559570312;
    network.weights[4][4 * 5 + 1 * 1] = 0.8101882934570312;
    network.weights[4][4 * 5 + 2 * 1] = 0.9800970554351807;
    network.weights[4][4 * 5 + 3 * 1] = 0.1146882176399231;
    network.weights[4][4 * 5 + 4 * 1] = 0.3167651295661926;
    network.weights[4][5 * 5 + 0 * 1] = 0.6965049505233765;
    network.weights[4][5 * 5 + 1 * 1] = 0.9142746925354004;
    network.weights[4][5 * 5 + 2 * 1] = 0.9351036548614502;
    network.weights[4][5 * 5 + 3 * 1] = 0.9411783814430237;
    network.weights[4][5 * 5 + 4 * 1] = 0.5995072722434998;
    network.weights[5][0 * 6 + 0 * 1] = 0.06520867347717285;
    network.weights[5][0 * 6 + 1 * 1] = 0.5459962487220764;
    network.weights[5][0 * 6 + 2 * 1] = 0.18719732761383057;
    network.weights[5][0 * 6 + 3 * 1] = 0.03402292728424072;
    network.weights[5][0 * 6 + 4 * 1] = 0.944246232509613;
    network.weights[5][0 * 6 + 5 * 1] = 0.8801798820495605;
    network.weights[5][1 * 6 + 0 * 1] = 0.0012360215187072754;
    network.weights[5][1 * 6 + 1 * 1] = 0.5935860276222229;
    network.weights[5][1 * 6 + 2 * 1] = 0.4157699942588806;
    network.weights[5][1 * 6 + 3 * 1] = 0.41771942377090454;
    network.weights[5][1 * 6 + 4 * 1] = 0.2711215615272522;
    network.weights[5][1 * 6 + 5 * 1] = 0.6922780871391296;
    network.weights[5][2 * 6 + 0 * 1] = 0.2038482427597046;
    network.weights[5][2 * 6 + 1 * 1] = 0.6832956671714783;
    network.weights[5][2 * 6 + 2 * 1] = 0.75285404920578;
    network.weights[5][2 * 6 + 3 * 1] = 0.8579357862472534;
    network.weights[5][2 * 6 + 4 * 1] = 0.6869555711746216;
    network.weights[5][2 * 6 + 5 * 1] = 0.0051323771476745605;
    network.weights[5][3 * 6 + 0 * 1] = 0.17565155029296875;
    network.weights[5][3 * 6 + 1 * 1] = 0.7496575117111206;
    network.weights[5][3 * 6 + 2 * 1] = 0.6046506762504578;
    network.weights[5][3 * 6 + 3 * 1] = 0.1099579930305481;
    network.weights[5][3 * 6 + 4 * 1] = 0.21209025382995605;
    network.weights[5][3 * 6 + 5 * 1] = 0.9703746438026428;
    network.weights[5][4 * 6 + 0 * 1] = 0.8369089365005493;
    network.weights[5][4 * 6 + 1 * 1] = 0.28198742866516113;
    network.weights[5][4 * 6 + 2 * 1] = 0.3741576075553894;
    network.weights[5][4 * 6 + 3 * 1] = 0.023700952529907227;
    network.weights[5][4 * 6 + 4 * 1] = 0.49101293087005615;
    network.weights[5][4 * 6 + 5 * 1] = 0.12347054481506348;
    network.weights[5][5 * 6 + 0 * 1] = 0.11432164907455444;
    network.weights[5][5 * 6 + 1 * 1] = 0.4724501967430115;
    network.weights[5][5 * 6 + 2 * 1] = 0.5750725269317627;
    network.weights[5][5 * 6 + 3 * 1] = 0.2952348589897156;
    network.weights[5][5 * 6 + 4 * 1] = 0.7966887950897217;
    network.weights[5][5 * 6 + 5 * 1] = 0.19573044776916504;
    network.weights[5][6 * 6 + 0 * 1] = 0.9536850452423096;
    network.weights[5][6 * 6 + 1 * 1] = 0.8426499366760254;
    network.weights[5][6 * 6 + 2 * 1] = 0.07835853099822998;
    network.weights[5][6 * 6 + 3 * 1] = 0.3755578398704529;
    network.weights[5][6 * 6 + 4 * 1] = 0.5225613117218018;
    network.weights[5][6 * 6 + 5 * 1] = 0.572950541973114;
    network.biases[1][0 * 1] = 0.6185871362686157;
    network.biases[1][1 * 1] = 0.6962141394615173;
    network.biases[1][2 * 1] = 0.5299500823020935;
    network.biases[2][0 * 1] = 0.25603562593460083;
    network.biases[2][1 * 1] = 0.7365944981575012;
    network.biases[2][2 * 1] = 0.020375549793243408;
    network.biases[2][3 * 1] = 0.20364665985107422;
    network.biases[3][0 * 1] = 0.3748350739479065;
    network.biases[3][1 * 1] = 0.2564433217048645;
    network.biases[3][2 * 1] = 0.32508331537246704;
    network.biases[3][3 * 1] = 0.09018915891647339;
    network.biases[3][4 * 1] = 0.3936424255371094;
    network.biases[4][0 * 1] = 0.6068782210350037;
    network.biases[4][1 * 1] = 0.17426711320877075;
    network.biases[4][2 * 1] = 0.4743403196334839;
    network.biases[4][3 * 1] = 0.8579254150390625;
    network.biases[4][4 * 1] = 0.4485998749732971;
    network.biases[4][5 * 1] = 0.513896107673645;
    network.biases[5][0 * 1] = 0.4568655490875244;
    network.biases[5][1 * 1] = 0.6011906862258911;
    network.biases[5][2 * 1] = 0.8179197311401367;
    network.biases[5][3 * 1] = 0.9736230969429016;
    network.biases[5][4 * 1] = 0.8175279498100281;
    network.biases[5][5 * 1] = 0.974706768989563;
    network.biases[5][6 * 1] = 0.46383917331695557;

    // fill gradients
    double *nabla_w1 = malloc(6 * sizeof(double));
    nabla_w1[0 * 2 + 0 * 1] = 0.00014736726006958634;
    nabla_w1[0 * 2 + 1 * 1] = 0.00022812944371253252;
    nabla_w1[1 * 2 + 0 * 1] = 0.0001552629837533459;
    nabla_w1[1 * 2 + 1 * 1] = 0.0002403522958047688;
    nabla_w1[2 * 2 + 0 * 1] = 0.0002777930931188166;
    nabla_w1[2 * 2 + 1 * 1] = 0.00043003298924304545;
    double *nabla_w2 = malloc(12 * sizeof(double));
    nabla_w2[0 * 3 + 0 * 1] = 0.0004676853131968528;
    nabla_w2[0 * 3 + 1 * 1] = 0.0004341940802987665;
    nabla_w2[0 * 3 + 2 * 1] = 0.0004249495395924896;
    nabla_w2[1 * 3 + 0 * 1] = 0.00038183305878192186;
    nabla_w2[1 * 3 + 1 * 1] = 0.00035448974813334644;
    nabla_w2[1 * 3 + 2 * 1] = 0.00034694222267717123;
    nabla_w2[2 * 3 + 0 * 1] = 0.0006777541129849851;
    nabla_w2[2 * 3 + 1 * 1] = 0.0006292196922004223;
    nabla_w2[2 * 3 + 2 * 1] = 0.0006158228497952223;
    nabla_w2[3 * 3 + 0 * 1] = 0.0008560148417018354;
    nabla_w2[3 * 3 + 1 * 1] = 0.0007947150734253228;
    nabla_w2[3 * 3 + 2 * 1] = 0.000777794630266726;
    double *nabla_w3 = malloc(20 * sizeof(double));
    nabla_w3[0 * 4 + 0 * 1] = 0.0030200257897377014;
    nabla_w3[0 * 4 + 1 * 1] = 0.002935037249699235;
    nabla_w3[0 * 4 + 2 * 1] = 0.00297541543841362;
    nabla_w3[0 * 4 + 3 * 1] = 0.002959620440378785;
    nabla_w3[1 * 4 + 0 * 1] = 0.002568012336269021;
    nabla_w3[1 * 4 + 1 * 1] = 0.00249574426561594;
    nabla_w3[1 * 4 + 2 * 1] = 0.0025300788693130016;
    nabla_w3[1 * 4 + 3 * 1] = 0.002516648033633828;
    nabla_w3[2 * 4 + 0 * 1] = 0.002611168660223484;
    nabla_w3[2 * 4 + 1 * 1] = 0.0025376861449331045;
    nabla_w3[2 * 4 + 2 * 1] = 0.0025725977029651403;
    nabla_w3[2 * 4 + 3 * 1] = 0.0025589412543922663;
    nabla_w3[3 * 4 + 0 * 1] = 0.00173843780066818;
    nabla_w3[3 * 4 + 1 * 1] = 0.001689515309408307;
    nabla_w3[3 * 4 + 2 * 1] = 0.0017127584433183074;
    nabla_w3[3 * 4 + 3 * 1] = 0.001703666290268302;
    nabla_w3[4 * 4 + 0 * 1] = 0.0030335693154484034;
    nabla_w3[4 * 4 + 1 * 1] = 0.002948199864476919;
    nabla_w3[4 * 4 + 2 * 1] = 0.0029887589626014233;
    nabla_w3[4 * 4 + 3 * 1] = 0.0029728931840509176;
    double *nabla_w4 = malloc(30 * sizeof(double));
    nabla_w4[0 * 5 + 0 * 1] = 0.0019354114774614573;
    nabla_w4[0 * 5 + 1 * 1] = 0.0021126242354512215;
    nabla_w4[0 * 5 + 2 * 1] = 0.002231209073215723;
    nabla_w4[0 * 5 + 3 * 1] = 0.0022137986961752176;
    nabla_w4[0 * 5 + 4 * 1] = 0.0020637568086385727;
    nabla_w4[1 * 5 + 0 * 1] = 0.008271425031125546;
    nabla_w4[1 * 5 + 1 * 1] = 0.009028784930706024;
    nabla_w4[1 * 5 + 2 * 1] = 0.009535583667457104;
    nabla_w4[1 * 5 + 3 * 1] = 0.00946117751300335;
    nabla_w4[1 * 5 + 4 * 1] = 0.008819938637316227;
    nabla_w4[2 * 5 + 0 * 1] = 0.007747936993837357;
    nabla_w4[2 * 5 + 1 * 1] = 0.0084573645144701;
    nabla_w4[2 * 5 + 2 * 1] = 0.008932088501751423;
    nabla_w4[2 * 5 + 3 * 1] = 0.008862391114234924;
    nabla_w4[2 * 5 + 4 * 1] = 0.008261735551059246;
    nabla_w4[3 * 5 + 0 * 1] = 0.0025738319382071495;
    nabla_w4[3 * 5 + 1 * 1] = 0.002809500554576516;
    nabla_w4[3 * 5 + 2 * 1] = 0.0029672018717974424;
    nabla_w4[3 * 5 + 3 * 1] = 0.0029440487269312143;
    nabla_w4[3 * 5 + 4 * 1] = 0.002744513563811779;
    nabla_w4[4 * 5 + 0 * 1] = 0.006687155459076166;
    nabla_w4[4 * 5 + 1 * 1] = 0.007299454417079687;
    nabla_w4[4 * 5 + 2 * 1] = 0.007709183264523745;
    nabla_w4[4 * 5 + 3 * 1] = 0.007649027742445469;
    nabla_w4[4 * 5 + 4 * 1] = 0.007130609359592199;
    nabla_w4[5 * 5 + 0 * 1] = 0.0024389848113059998;
    nabla_w4[5 * 5 + 1 * 1] = 0.0026623066514730453;
    nabla_w4[5 * 5 + 2 * 1] = 0.0028117457404732704;
    nabla_w4[5 * 5 + 3 * 1] = 0.002789805643260479;
    nabla_w4[5 * 5 + 4 * 1] = 0.0026007243432104588;
    double *nabla_w5 = malloc(42 * sizeof(double));
    nabla_w5[0 * 6 + 0 * 1] = 0.07692304253578186;
    nabla_w5[0 * 6 + 1 * 1] = 0.0738210380077362;
    nabla_w5[0 * 6 + 2 * 1] = 0.07079878449440002;
    nabla_w5[0 * 6 + 3 * 1] = 0.07586955279111862;
    nabla_w5[0 * 6 + 4 * 1] = 0.07496694475412369;
    nabla_w5[0 * 6 + 5 * 1] = 0.0780075266957283;
    nabla_w5[1 * 6 + 0 * 1] = 0.08093193173408508;
    nabla_w5[1 * 6 + 1 * 1] = 0.07766825705766678;
    nabla_w5[1 * 6 + 2 * 1] = 0.07448849827051163;
    nabla_w5[1 * 6 + 3 * 1] = 0.07982353121042252;
    nabla_w5[1 * 6 + 4 * 1] = 0.0788738876581192;
    nabla_w5[1 * 6 + 5 * 1] = 0.08207292854785919;
    nabla_w5[2 * 6 + 0 * 1] = 0.028045697137713432;
    nabla_w5[2 * 6 + 1 * 1] = 0.026914723217487335;
    nabla_w5[2 * 6 + 2 * 1] = 0.025812827050685883;
    nabla_w5[2 * 6 + 3 * 1] = 0.027661599218845367;
    nabla_w5[2 * 6 + 4 * 1] = 0.02733251452445984;
    nabla_w5[2 * 6 + 5 * 1] = 0.028441093862056732;
    nabla_w5[3 * 6 + 0 * 1] = 0.01650899648666382;
    nabla_w5[3 * 6 + 1 * 1] = 0.015843253582715988;
    nabla_w5[3 * 6 + 2 * 1] = 0.015194626525044441;
    nabla_w5[3 * 6 + 3 * 1] = 0.01628289930522442;
    nabla_w5[3 * 6 + 4 * 1] = 0.0160891842097044;
    nabla_w5[3 * 6 + 5 * 1] = 0.01674174703657627;
    nabla_w5[4 * 6 + 0 * 1] = 0.046306200325489044;
    nabla_w5[4 * 6 + 1 * 1] = 0.04443885013461113;
    nabla_w5[4 * 6 + 2 * 1] = 0.04261951148509979;
    nabla_w5[4 * 6 + 3 * 1] = 0.04567201808094978;
    nabla_w5[4 * 6 + 4 * 1] = 0.04512866586446762;
    nabla_w5[4 * 6 + 5 * 1] = 0.046959038823843;
    nabla_w5[5 * 6 + 0 * 1] = 0.004584846086800098;
    nabla_w5[5 * 6 + 1 * 1] = 0.0043999566696584225;
    nabla_w5[5 * 6 + 2 * 1] = 0.0042198216542601585;
    nabla_w5[5 * 6 + 3 * 1] = 0.004522054456174374;
    nabla_w5[5 * 6 + 4 * 1] = 0.0044682566076517105;
    nabla_w5[5 * 6 + 5 * 1] = 0.004649484530091286;
    nabla_w5[6 * 6 + 0 * 1] = 0.02480097860097885;
    nabla_w5[6 * 6 + 1 * 1] = 0.02380084991455078;
    nabla_w5[6 * 6 + 2 * 1] = 0.022826436907052994;
    nabla_w5[6 * 6 + 3 * 1] = 0.02446131780743599;
    nabla_w5[6 * 6 + 4 * 1] = 0.02417030557990074;
    nabla_w5[6 * 6 + 5 * 1] = 0.02515062876045704;
    double *nabla_b1 = malloc(3 * sizeof(double));
    nabla_b1[0 * 1] = 0.000296957790851593;
    nabla_b1[1 * 1] = 0.00031286836019717157;
    nabla_b1[2 * 1] = 0.0005597771378234029;
    double *nabla_b2 = malloc(4 * sizeof(double));
    nabla_b2[0 * 1] = 0.000608492991887033;
    nabla_b2[1 * 1] = 0.0004967928980477154;
    nabla_b2[2 * 1] = 0.0008818079368211329;
    nabla_b2[3 * 1] = 0.001113738282583654;
    double *nabla_b3 = malloc(5 * sizeof(double));
    nabla_b3[0 * 1] = 0.003565648104995489;
    nabla_b3[1 * 1] = 0.0030319702345877886;
    nabla_b3[2 * 1] = 0.0030829235911369324;
    nabla_b3[3 * 1] = 0.0020525180734694004;
    nabla_b3[4 * 1] = 0.0035816386807709932;
    double *nabla_b4 = malloc(6 * sizeof(double));
    nabla_b4[0 * 1] = 0.002565140137448907;
    nabla_b4[1 * 1] = 0.0109627153724432;
    nabla_b4[2 * 1] = 0.01026889868080616;
    nabla_b4[3 * 1] = 0.0034112846478819847;
    nabla_b4[4 * 1] = 0.008862968534231186;
    nabla_b4[5 * 1] = 0.003232562215998769;
    double *nabla_b5 = malloc(7 * sizeof(double));
    nabla_b5[0 * 1] = 0.0795859694480896;
    nabla_b5[1 * 1] = 0.08373363316059113;
    nabla_b5[2 * 1] = 0.029016584157943726;
    nabla_b5[3 * 1] = 0.017080506309866905;
    nabla_b5[4 * 1] = 0.04790922999382019;
    nabla_b5[5 * 1] = 0.004743564408272505;
    nabla_b5[6 * 1] = 0.02565953880548477;

    // fill inputs and label
    double *inputs = malloc(2 * sizeof(double));
    inputs[0 * 1] = 0.49625658988952637;
    inputs[1 * 1] = 0.7682217955589294;
    double *label = malloc(7 * sizeof(double));
    label[0 * 1] = 0.08847743272781372;
    label[1 * 1] = 0.13203048706054688;
    label[2 * 1] = 0.30742281675338745;
    label[3 * 1] = 0.6340786814689636;
    label[4 * 1] = 0.4900934100151062;
    label[5 * 1] = 0.8964447379112244;
    label[6 * 1] = 0.455627977848053;

    // run backprop
    forward(network, inputs);
    double loss = compute_loss(network, label);
    backward(network, label);
    // compare loss
    assert_scalar("loss", 2.4518797397613525, loss);

    // compare gradients
    assert_array("nabla_w1", 6, nabla_w1, network.weights_grad[1]);
    assert_array("nabla_w2", 12, nabla_w2, network.weights_grad[2]);
    assert_array("nabla_w3", 20, nabla_w3, network.weights_grad[3]);
    assert_array("nabla_w4", 30, nabla_w4, network.weights_grad[4]);
    assert_array("nabla_w5", 42, nabla_w5, network.weights_grad[5]);
    assert_array("nabla_b1", 3, nabla_b1, network.biases_grad[1]);
    assert_array("nabla_b2", 4, nabla_b2, network.biases_grad[2]);
    assert_array("nabla_b3", 5, nabla_b3, network.biases_grad[3]);
    assert_array("nabla_b4", 6, nabla_b4, network.biases_grad[4]);
    assert_array("nabla_b5", 7, nabla_b5, network.biases_grad[5]);

    // free gradients
    free(nabla_w1);
    free(nabla_w2);
    free(nabla_w3);
    free(nabla_w4);
    free(nabla_w5);
    free(nabla_b1);
    free(nabla_b2);
    free(nabla_b3);
    free(nabla_b4);
    free(nabla_b5);
    // free inputs and labels
    free(inputs);
    free(label);
    // destroy network
    network_destroy(network);
}
